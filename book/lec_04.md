---
title: "Лекция 4. Операторы создания, модификации и удаления таблиц БД"
layout: bookpage
lang: ru
navigation_weight: 4
---

# Лекция 4. Операторы создания, модификации и удаления таблиц БД


# 1. Основные понятия языка SQL

# 2. CREATE TABLE

# 3. ALTER TABLE

# 4. DROP TABLE

# 5. INSERT, DELETE и TRUNCATE, UPDATE



# 1. Основные понятия языка SQL

1. SQL – непроцедурный язык (“что должно содержаться в результате”)
2. Ориентирован на множества
3. Результат операции – отношение
4. интерактивный SQL: введенная команда выполняется и результат отображается
5. Вложенный SQL: процедурное расширение (SQL команды, помешенных внутри программ C#, С++, РНР); Transact SQL от MS SQL Server или PL/SQL от ORACLE 

Категории команд SQL
Data Definition Language (DDL): создание объектов (таблиц, представлений, индексов)

1. создать БД 
2. определить структуру новой таблицы и создать эту таблицу,
3. изменить определение существующей таблицы,
4. удалить существующую таблицу,
5. определить представление данных, 
6. обеспечить условия безопасности БД,
7. создать индексы для доступа к таблицам,
8. управлять размещением данных на устройствах хранения.

Data Manipulation Language (DML): манипулирования данными в структурах данных

Data Control Language (DCL): может ли пользователь выполнить отдельное действие

Предложения DDL:

| Создать объект  | Удалить объект | Модифицировать объект | 
|-----------------|----------------|-----------------------|
| CREATE DATABASE | DROP DATABASE  | ALTER DATABASE        | 
| CREATE DOMAIN   | DROP DOMAIN    | ALTER DOMAIN          | 
| CREATE INDEX    | DROP INDEX     | ALTER INDEX           | 
| CREATE PROCEDURE| DROP PROCEDURE | ALTER PROCEDURE       | 
| CREATE TABLE    | DROP TABLE     | ALTER TABLE           | 
| CREATE TRIGGER  | DROP TRIGGER   | ALTER TRIGGER         | 
| CREATE VIEW     | DROP VIEW      | ALTER VIEW            | 

Предложения DML:


| Изменяют данные таблиц | Не изменяют данные таблиц |
|------------------------|---------------------------|
| INSERT                 | SELECT                    |
| DELETE                 |                           |
| UPDATE                 |                           |

Предложения DCL:

| Предоставить право    | Удалить право             |
|------------------------|---------------------------|
| GRANT                  | REVOKE                    |

GRANT SELECT ON STUD TO USERB // дать пользователю SB право  выполнить SELECT для таблицы STUD

GRANT INSERT ON STUD TO USERB // // дать пользователю SB право  выполнить INSERT для таблицы STUD

GRANT UPDATE (FAM) ON STUD TO USERB //позволено модифицировать только поле FAM

REVOKE DELETE, INSERT ON STUD TO USERB //отмена привилегий на удаление и вставку

# 2. SQL-оператор CREATE TABLE

CREATE TABLE:

1. создает пустую таблицу (без строк)
2. значения - INSERT,
3. определяет имя таблицы и множество столбцов в указанном порядке (1 таблица MIN 1 столбец), 
4. для каждого столбца - тип данных и размер,
5. для каждого столбца могут быть определены различные ограничения (PK, FK, Not Null, Unique, Default, Check, Constraint)

Пример - Создание таблицы STUDENT (STUDENT (ID – номер зачетки, FAM – фамилия, STIP – стипендия, OCENКА - оценка, GR – группа, CITY – город, BIRTHDAY – год рождения ))

~~~SQL

CREATE TABLE STUDENT
	(ID  SMALLINT NOT NULL PRIMARY KEY,
FAM  NVARCHAR(10), 
STIP  NUMERIC (6, 2),
OCENКА  TINYINT,
GR  NVARCHAR(5),
CITY  NVARCHAR(15),
BIRTHDAY  SMALLDATETIME
)
~~~

Ограничения на уровне поля:

1. неопределенных значений (NOT NULL - запрет неопределенных значений) (NULL — это маркер пустого поля, NULL вводится по умолчанию),
2. уникальности столбца (UNIQUE) (UNIQUE только совместно с ограничением NOT NULL),
3. первичного ключа (PRIMARY KEY, эквивалентно NOT NULL UNIQUE),
4. внешнего ключа (ограничения столбца по ссылке) (FOREING KEY),
5. проверки на допустимость значения (CHECK),
6. ограничения заданных по умолчанию значений (DEFAULT).

~~~SQL
CREATE TABLE STUDENT
(…
FAM  NVARCHAR(10) NOT NULL,
NAME  NVARCHAR(10) NOT NULL,
…
UNIQUE (FAM,  NAME))
~~~

Пример. Введение ограничений на поле OCENКА 

~~~SQL
CREATE TABLE STUDENT
(…
OCENКА  TINYINT CHECK (OCENКА  <=5),
…)
Или OCENКА  TINYINT CHECK IN (2, 3, 4, 5) … .
Или OCENКА  TINYINT CHECK (OCENКА  BETWEEN 2 AND 5) … . 
Или CONSTRAINT CH_ OCENКА CHECK (OCENКА  <=5)
~~~

*Значение по умолчанию*: [DEFAULT {<значение>|USER|NULL}] – ключевое слово USER: при заполнении столбца ему будет присвоена символьная строка, содержащая имя текущего пользователя.

~~~SQL
CREATE TABLE STUDENT
(…
OCENКА  TINYINT CHECK IN (2, 3, 4, 5) 
	DEFAULT 5,
…)
~~~

|    GROUPS   |
|-------------|
| Name |  ID  |
| ...  | ...  |
| 535  | 18   |
| ...  | ...  |

|       STUDENT       |
|---------------------|
| ID_GROUP | ID | ... |
| ...      | ...| ... |
| 18       | 6  | ... |
| 18       | 9  | ... |
| 18       | 12 | ... |
| ...      | ...| ... |


~~~SQL
CREATE TABLE STUDENT (  …
ID_GROUP TINYINT NOT NULL,
…
CONSTRAINT FK_STUD FOREING KEY (ID_GROUP) REFERENCES                   GROUPS(ID) 
ON DELETE CASCADE   ON UPDATE CASCADE))
~~~

Определение внешнего ключа:
1. Основная таблица д/б описана до подчиненной
2. Все поля - внешние ключи, должны в родительской таблице иметь (PRIMARY KEY) или (NOT NULL и UNIQUE)
3. Для определения поля - внешнего ключа, его нужно определить - наименование, тип данных
4. После определения всех полей - одно или несколько определений FOREING KEY, которые задают поле внешнего ключа и определяют таблицу и поле, на которое ссылается внешний ключ. 
5. Несколько определений FOREING KEY перечисляются через запятую.

Поддержка ссылочной целостности:
1. ON DELETE CASCADE - кортежи подчиненного отношения уничтожаются при удалении связанных с ними кортежей основного отношения. Определение “ON DELETE CASCADE” включает механизм каскадного удаления: СУБД удаляет записи, которые ссылаются на этот первичный ключ) 
2. ON DELETE SET NULL - кортежи подчиненного отношения модифицируются в NULL при удалении связанных с ними кортежей основного отношения,
3. ON DELETE No Action - запрет на удаление кортежа основного отношения при наличии кортежей подчиненного отношения, связанных с ним.

# 3. SQL-оператор ALTER TABLE

Синтаксис:
~~~SQL
ALTER TABLE <имя> {
	[ALTER COLUMN <определение_столбца>] | [ADD <определение_столбца>] |
	[DROP COLUMN <имя_столбца>] |
	[ADD CONSTRAINT <ограничение_для_таблицы>]
	}
~~~
Пример: 

~~~SQL
ALTER TABLE STUDENT ADD СOURSE TINYINT, SPEC NVARCHAR(10)
ALTER TABLE STUDENT DROP COLUMN СOURSE
~~~

# 4. SQL-оператор DROP TABLE

Синтаксис:
DROP TABLE <имя_таблицы1>, <имя_таблицы2>,… 
1. Для удаления таблицы, пользователь должен быть ее создателем
2. Перед удалением желательно произвести очистку таблицы от данных
3. Операция удаления выполняется вне зависимости от того, существуют в таблице данные или нет. 
4. После удаления таблицы ее восстановление не возможно 
5. Правило ссылочной целостности: нельзя удалить таблицу с первичным ключ, пока не будет удалена связанная с ней таблица с внешним ключом

# 5. SQL-операторы INSERT, DELETE, UPDATE

Синтаксис (первая форма – явно заданные данные)
INSERT INTO <имя_таблицы> [(поле1, поле2, ...)] VALUES (значение1, значение2, ...)

1. INSERT вставляет одну запись в таблицу с именем “имя_таблицы”
2. Каждый оператор - только одну таблицу
3. Cовместимость типов данных полей и типов данных значений
INSERT INTO STUDENT (FAM, STIP, OCENКА, ID_GROUPS) VALUES ( ‘Петров’, 500, 4, 3)

TRUNCATE TABLE удаляет все строки в таблице. 
DELETE - удаление избранных строк с WHERE
Синтаксис:

~~~SQL
DELETE [FROM] таблица_или_представление        [FROM источники_таблиц] [WHERE условие_отбора]

DELETE FROM STUDENT - удаление всего содержимого таблицы STUDENT.
DELETE FROM STUDENT WHERE OCENKA=5
DELETE FROM STUDENT WHERE TDATE<=31/03/2012
DELETE  FROM  STUDENT  FROM GROUPS
	    WHERE  STUDENT.OCENKA=5 And GROUPS.ID=2
~~~

Особенности DELETE

1. Первая клауза FROM - для удобочитаемости
2. Список столбцов в DELETE не указывается: при удалении строки удаляются все столбцы. 
3. Необязательная клауза WHERE указывает, какие строки следует удалить
4. Если WHERE опущена, удаляются все строки в указанной таблице
5. Необязательная вторая клауза FROM позволяет задавать дополнительные источники (таблицы) в условии отбора в фразе WHERE

Особенности TRUNCATE

1. При TRUNCATE TABLE автоинкрементный счетчик обнуляется, при добавлении следующей строки будет использовано исходное начальное значение для этого столбца
2. Оператор TRUNCATE TABLE нельзя использовать для таблиц, на которую есть ссылки внешнего ключа из других таблиц. В этом случае надо использовать DELETE.
3. Удаления, выполненные посредством TRUNCATE TABLE, не активизируют триггеры удаления

Синтаксис UPDATE:

~~~SQL
UPDATE <имя_таблицы> 
	SET <имя_столбца>=<значение> [,<имя_столбца>= <значение>] 
	[FROM <имя_таблиц(ы)_источника>] 
	[WHERE <условие ограничения>]
~~~

~~~SQL
UPDATE STUDENT SET POINT=POINT+15 
	WHERE  ADDCOURSE=‘UDACITY’
~~~